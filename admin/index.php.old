<?php
  error_reporting(-1);
  ini_set("display_errors", 1);

  if (array_key_exists("action",$_GET)) {
    if ($_GET['action'] == 'start-mt-server') {
      exec('scripts/start-mt-server.perl 2> err');
    }
    if ($_GET['action'] == 'start-cat-server') {
      exec('scripts/start-cat-server.sh');
    }
  }
?>
<html><head><title>CASMACAT Home Edition</title>
<link href="/public/css/style.css" rel=stylesheet type="text/css">
<body>
<center><img src="casmacat-logo.png" width=421 height=174>
<p><b>Home Edition</b>
<table><tr><td>

<p>Administration</p>
<ul>
<?php
  $cat_server_online = 0;
  $mt_server_online = 0;
  $ret = array();
  exec('/bin/ps -ef',$ret);
  foreach($ret as $line) {
    if (strpos($line,"/opt/casmacat/cat-server/cat-server.py --port 9999") !== false) {
      $cat_server_online++;
    }
    if (strpos($line,"/opt/moses/bin/mosesserver") !== false) {
      $mt_server_online++;
    }
    if (strpos($line,"/opt/casmacat/mt-server/python_server/server.py") !== false) {
      $mt_server_online++;
    }
  }
  if ($cat_server_online == 0) {
    print "<li><a href=\"/?action=start-cat-server\">Start CAT server</a>\n";
  }
  if ($mt_server_online != 2) {
    print "<li><a href=\"/?action=start-mt-server\">Start MT server</a>\n";
  }
  if ($cat_server_online == 1 && $mt_server_online == 2) {
    print "<li><a href=\"http://$ip:8000/\">Translate new document</a>\n";
  }
?>
<li><a href="/mt-builder/">Build MT system</a>
</ul>
</td></tr></table>
</body></html>
